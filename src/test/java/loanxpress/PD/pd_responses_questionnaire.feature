Feature: User performs PD Meta Save request with dynamic pdId mapping for multiple applicants

  Background:
     * url BASE_URL_PD
    * def result = call read('classpath:loanxpress/PD/pd_owner_login.feature')
    * def token = result.response.dt.token
    * print 'Token:', token
  
  * def pd_metadata_list = call read('classpath:loanxpress/PD/pd_metadata_list.feature')
    * def pdid1 = pd_metadata_list.response.result[0].id
    * def pdid2 = pd_metadata_list.response.result[1].id
    * def pdid3 = pd_metadata_list.response.result[2].id

    * configure headers = { Authorization: '#(token)', Accept: 'application/json, text/plain, */*', 'accept-language': 'en-GB,en-US;q=0.9,en;q=0.8', 'user-agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36', Origin: 'https://ilos-uat.capriglobal.in', Priority: 'u=1, i', Referer: 'https://ilos-uat.capriglobal.in/', 'sec-ch-ua': '"Google Chrome";v="131", "Chromium";v="131", "Not_A Brand";v="24"', 'sec-ch-ua-mobile': '?0', 'sec-ch-ua-platform': '"Linux"', 'sec-fetch-dest': 'empty', 'sec-fetch-mode': 'cors', 'sec-fetch-site': 'same-site' }

  @Sanity1 @tc0020
  Scenario: Automate PD Meta Save Request for first applicant with dynamic pdId mapping
    Given path '/responses/questionnaire'
    And request {"pdId":"#(pdid1)","questionnaire":{"Application Details":{"portfolio":"home loan","end_use_of_loan":"plot purchase and construction","transaction_type":"plot purchase and construction","application_id":"#(APP_ID)","branch_name":"LUCKNOW_HL_1","requested_loan_amount":500000,"requested_roi":"16.00","request_tenure":"180"},"PD Details":{"pd_done_by_name":"Jaipragatiuser15","pd_done_by_id":"BU0005","is_other_capri_employee":"No","name":"","pd_date":"13-12-2024","pd_time":"14:03","pd_location":"gurgaon","person_met_during_pd":["CHHAYA PHILLIPS"],"other_employee":[{"name":""}]},"Applicant Details":{"applicant_name":"VERNON PHILLIPS","high_qualification":"Graduate","dependent":"0","current_address":"936 ASHIRWAD SECTOR","current_address_type":"owned","parmanent_addres":"936 ASHIRWAD SECTOR","current_address_vintage":"180","is_current_address_same_as_applicant_address":"No","residence_address_as_per_pd":"none"},"residence_tpc_details":{"applicant_name":"VERNON PHILLIPS","current_address_landmark":"pnb atm","occupancy_status":"self_owned","locality":"Independent house","person_met":"none","years_residence":"6","any_earning_member":"","no_family_members":"","several_medical_condition_in_family":"Yes","neighbour_name":"none","neighbour_recognize":"yes","neighbour_contact_no":"","neighbour_reference":"positive","neighbour_comments":"ok"},"Interviewers Comment":{"interview_comment":"ok","status":"positive"}},"isFinalSubmit":true}
    When method POST    
    Then status 200
    Then print 'Response for first applicant customer detail:', response

  @Sanity1 @tc0020
  Scenario: Automate PD Meta Save Request for second applicant with dynamic pdId mapping
    Given path '/responses/questionnaire'
    And request {"pdId":"#(pdid2)","questionnaire":{"Application Details":{"portfolio":"home loan","end_use_of_loan":"plot purchase and construction","transaction_type":"plot purchase and construction","application_id":"#(APP_ID)","branch_name":"LUCKNOW_HL_1","requested_loan_amount":500000,"requested_roi":"16.00","request_tenure":"180"},"PD Details":{"pd_done_by_name":"Jaipragatiuser15","pd_done_by_id":"BU0005","is_other_capri_employee":"No","name":"","code":"","pd_date":"13-12-2024","pd_time":"14:03","pd_location":"Gurgaon","person_met_during_pd":["CHHAYA PHILLIPS"],"other_employee":[{"name":"","code":""}]},"Business PD - Bussiness Details":{"vintage_of_Existing_business":"10","type_of_business_premises":"self-owned","nature_of_business":"service","industry_type":"computer software","sub_industry_type":"software development","Monthly_Annually_Turnover_Monthly_Salary_gross":"50,000","net_monthly_annually_profit":"10,000","margin_in_business":20,"Level_of_Business_activity_observed":"low","details_of_machines_observed_during_pd":"","number_of_employees":"50","total_monthly_salary_on_employees":"25,00,000"},"Business Profile Comment":{"comment_on_business_profile":"ok"},"Business PD - Documents Details":{"documents_observed_during_pd":["Aadhar"]},"Business PD - Live Loan Details / Obligation":{},"Trade References":{"other_trade_reference":[{"tradeReferenceName":"capri","firmName":"","contactNo":"9182818181","natureOfTransaction":"","approxBussPerMonth":"","noOfYearsDealt":"","tradeReferenceFeedback":""}]},"Loan OCR & End Use":{"end_use_of_loan_ocr":"plot purchase and construction","source_of_OCR":"test","total_ocr":"12","cost_of_purchase":"1,00,000","cost_of_construction":"","lcr":"1","lcr_plot":"test","lcr_construction":"test","property_type":"residential","occupancy":"vacant","total_deal_amount":"25,00,000","lcr_remarks":"ok"},"CIBIL Inquiry Details":{"other_cibil":[{"date_applied":"Invalid Date","financer_name":"","type_of_loan":"","loan_amount":"","cibilRemark":""}]},"Strengths and Other Remarks":{"strengths_comment":"none","strengths_remark":"","total_assets":"2","total_liabilities":"1","net_worth":"1"},"Personal Reference Check":{"other_reference":[{"reference_name":"Rahul","relationship_with_applicant":"Neighbour","mobile_no":"8988688998","personalAddress":"","feedback":"Positive"},{"reference_name":"vivek","relationship_with_applicant":"Neighbour","mobile_no":"9869853985","personalAddress":"","feedback":"Positive"}]},"Risk Category":{"risk_category":[{"id":1,"question":"NRI","pa_921466":"YES","ca_921472":"YES","pa_921466_disabled":false,"ca_921472_disabled":false},{"id":2,"question":"High net-worth individuals above Rs. 50 Cr","pa_921466":"YES","ca_921472":"YES","pa_921466_disabled":false,"ca_921472_disabled":false},{"id":3,"question":"Trust, charities, NGOs, and organizations receiving donations","pa_921466":"YES","ca_921472":"YES","pa_921466_disabled":false,"ca_921472_disabled":false},{"id":4,"question":"Politically exposed persons (PEPs) are individuals who are or have been entrusted with prominent public functions by a foreign country, including the Heads of States/Governments, senior politicians, senior government or judicial or military officers, senior executives of state-owned corporations and important political party officials","pa_921466":"YES","ca_921472":"YES","pa_921466_disabled":false,"ca_921472_disabled":false},{"id":5,"question":"Persons with dubious reputation as per public information available","pa_921466":"YES","ca_921472":"YES","pa_921466_disabled":false,"ca_921472_disabled":false},{"id":6,"question":"Persons whose sources of income are not clear","pa_921466":"YES","ca_921472":"YES","pa_921466_disabled":false,"ca_921472_disabled":false},{"id":7,"question":"Non face to face to customers for Loan amount > Rs. 5 Lacs","pa_921466":"YES","ca_921472":"YES","pa_921466_disabled":false,"ca_921472_disabled":false},{"id":8,"question":"Companies having close family shareholding or beneficial ownership","pa_921466":"YES","ca_921472":"YES","pa_921466_disabled":false,"ca_921472_disabled":false},{"id":9,"question":"Firms with sleeping partners","pa_921466":"YES","ca_921472":"YES","pa_921466_disabled":false,"ca_921472_disabled":false},{"id":10,"question":"Negative Profile","pa_921466":"YES","ca_921472":"YES","pa_921466_disabled":false,"ca_921472_disabled":false},{"id":11,"question":"List Of Negative Profile","pa_921466":"Any contractor engaged into real estate development or related activities viz, colour etc","ca_921472":"Any contractor engaged into real estate development or related activities viz, colour etc","pa_921466_disabled":false,"ca_921472_disabled":false},{"id":12,"question":"KYC RISK CATEGORY","pa_921466":"High","ca_921472":"High","pa_921466_disabled":true,"ca_921472_disabled":true}]},"Interviewer's Comment":{"interview_comment":"ok","status":"positive"}},"isFinalSubmit":true}
    When method POST    
    Then status 200
    Then print 'Response for second applicant customer detail:', response

  @Sanity1 @tc0020
  Scenario: Automate PD Meta Save Request for third applicant with dynamic pdId mapping
    Given path '/responses/questionnaire'
    And request {"pdId":"#(pdid3)","questionnaire":{"Application Details":{"portfolio":"home loan","end_use_of_loan":"plot purchase and construction","transaction_type":"plot purchase and construction","application_id":"#(APP_ID)","branch_name":"LUCKNOW_HL_1","requested_loan_amount":500000,"requested_roi":"16.00","request_tenure":"180"},"Property Details 1":{"distance_of_nearest_branch":"10","distance_of_work_location":"10"},"Property Details 2":{"vintage_of_property":"5","relationship_with_applicant":"none","mobile_no":"9292393453"},"Property Details 3":{"is_there_any_board_on_property_saying_mortgaged":"No","is_property_located_negative_area":"No","is_property_located_dominated_area":"No","is_past_collection_issue":"No","is_any_bank_fund":"No"},"Interviewer's Comment":{"interview_comment":"ok","status":"positive"}},"isFinalSubmit":true}
    When method POST    
    Then status 200
    Then print 'Response for third applicant customer detail:', response
